#include <stdio.h>

typedef void(*PFV)();

namespace std {
  PFV set_unexpected(PFV);
}

struct X {};

struct Y {};

extern void f(int) throw (X,Y);

void pass_through()
{
  printf("pass_through called\n");
  throw;
}

class SUE {
  PFV old;
public:
  SUE(PFV f){ old = std::set_unexpected(f); }
  ~SUE(){ std::set_unexpected(old); }
};

void g(int n)
{
  SUE mine(&pass_through);

  try {
    f(n);
  }
  catch (X) {
    printf("catch X\n");
  }
  catch (Y) {
    printf("catch Y\n");
  }
  catch (...) {
    printf("catch something\n");
  }
}

int main()
{
  g(0);
  g(1);
  g(2);
  return 0;
}

struct Z {};

void f(int n) throw (X,Y)
{
  switch ( n ){
  case 0: throw X();
  case 1: throw Y();
  default: throw Z();
  }
}
